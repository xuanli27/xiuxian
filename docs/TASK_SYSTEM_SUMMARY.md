# 任务（摸鱼）系统总结

## 🎯 核心理念

将日常的"摸鱼"行为包装成修仙任务，让玩家在摸鱼的同时获得修为提升。每个任务都有修仙世界观的包装，让摸鱼变得更有趣！

## ✅ 已完成的工作

### 1. 数据库Schema更新
- ✅ 添加了 `TaskDifficulty` 枚举（EASY, MEDIUM, HARD）
- ✅ 添加了 `TaskCategory` 枚举（DAILY, WEEKLY, ACHIEVEMENT）
- ✅ 将Task.id改为String类型（使用cuid）
- ✅ 统一了奖励字段：`rewardQi`, `rewardContribution`, `rewardStones`
- ✅ 添加了 `acceptedAt` 时间戳

### 2. 类型定义更新
- ✅ 更新了 `features/tasks/types.ts`
- ✅ 从Prisma导出标准类型
- ✅ 定义了 `TaskCreateInput` 接口

### 3. Schema验证更新
- ✅ 更新了 `features/tasks/schemas.ts`
- ✅ 修正了任务类型为 LINK/GAME/BATTLE
- ✅ 添加了难度和分类验证

### 4. Server Actions更新
- ✅ 修复了所有字段引用
- ✅ 集成了摸鱼任务数据
- ✅ 实现了随机任务生成

### 5. 摸鱼任务数据
创建了 `data/tasks/moyu-tasks.ts`，包含：
- ✅ 6个日常摸鱼任务
- ✅ 4个每周摸鱼任务
- ✅ 2个成就任务
- ✅ 工具函数（随机获取、按难度筛选、按类型筛选）

## 🎮 任务类型

### LINK 类型（浏览网站）
玩家需要访问指定网站，停留一定时间。这些网站被包装成修仙相关的地点：

- **起点中文网** → 研习《起点仙侠录》（学习功法）
- **哔哩哔哩** → 观摩《B站修仙大会》（练习神通）
- **知乎** → 浏览《知乎问道》（问道交流）
- **GitHub** → 参悟《GitHub道藏》（领悟编程之道）
- **淘宝** → 逛《淘宝灵宝阁》（浏览灵宝）
- **Steam** → 深入《Steam仙境》（研究游戏系统）
- **Reddit** → 探索《Reddit异界》（海外交流）
- **网易云音乐** → 修习《网易云音律》（音律之道）

### GAME 类型（小游戏）
玩家需要完成小游戏任务：

- **清理灵识传音** → 处理邮件的小游戏
- **代码审查大阵** → 代码审查挑战
- **摸鱼宗师** → 连续摸鱼7天的成就挑战

### BATTLE 类型（战斗）
玩家需要进行战斗（暂未实现具体内容）

## 📊 任务分类

### DAILY（日常任务）
- 简单易完成
- 奖励适中
- 每天可刷新
- 例如：浏览网站、清理邮件

### WEEKLY（每周任务）
- 难度较高
- 奖励丰厚
- 每周可完成
- 例如：深度研究、代码审查

### ACHIEVEMENT（成就任务）
- 难度最高
- 奖励最丰厚
- 一次性完成
- 例如：摸鱼宗师、网络遨游者

## 🎁 奖励系统

每个任务完成后可获得：
- **灵气（Qi）**：用于修炼和突破境界
- **贡献度（Contribution）**：提升宗门地位
- **灵石（Stones）**：购买物品和资源

奖励根据任务难度和类型调整：
- EASY: 8-15灵气
- MEDIUM: 20-40灵气
- HARD: 50-100灵气

## 📁 文件结构

```
xiuxian/
├── prisma/
│   └── schema.prisma                    # Task模型定义
├── features/
│   └── tasks/
│       ├── types.ts                     # 类型定义
│       ├── schemas.ts                   # Zod验证
│       ├── actions.ts                   # Server Actions
│       └── queries.ts                   # 数据查询
├── data/
│   └── tasks/
│       └── moyu-tasks.ts                # 摸鱼任务数据
├── components/
│   └── tasks/
│       ├── TaskBoard.tsx                # 任务面板
│       ├── TaskCard.tsx                 # 任务卡片
│       └── minigames/                   # 小游戏组件
└── app/
    └── (game)/
        └── tasks/
            └── page.tsx                 # 任务页面
```

## 🎨 任务设计亮点

### 1. 修仙世界观包装
每个摸鱼行为都有修仙相关的描述：
- 看小说 → 研习功法
- 看视频 → 练习神通
- 逛淘宝 → 浏览灵宝
- 听音乐 → 修习音律

### 2. 幽默的描述
任务描述充满趣味性：
- "据说有人在小说中顿悟了新的功法..."
- "有人说在弹幕中能找到隐藏的修炼秘诀..."
- "虽然买不起，但看看也能增长见识..."

### 3. 多样化的任务
- 不同难度等级
- 不同任务类型
- 不同奖励机制
- 不同完成时长

### 4. 随机性
使用 `getRandomMoyuTasks()` 每次刷新都能获得不同的任务组合，增加可玩性。

## 🔧 核心功能

### 任务生成
```typescript
// 随机生成3个摸鱼任务
const tasks = await generateMultipleAITasks([], 3)
```

### 任务接取
```typescript
// 接取任务，状态变为IN_PROGRESS
await acceptTask(taskId)
```

### 任务完成
```typescript
// 完成任务，获得奖励
const result = await completeTask(taskId)
// result包含：task, player, rewards
```

### 任务放弃
```typescript
// 放弃任务，状态变为FAILED
await abandonTask(taskId)
```

## 🚀 使用方式

### 1. 玩家进入任务页面
访问 `/tasks` 路由

### 2. 查看可用任务
系统显示当前可接取的任务列表

### 3. 点击"刷新OA"
生成新的随机摸鱼任务

### 4. 接取任务
点击任务卡片开始执行

### 5. 完成任务
- LINK类型：访问指定网站
- GAME类型：完成小游戏
- BATTLE类型：完成战斗

### 6. 获得奖励
任务完成后自动获得灵气、贡献度和灵石

## 📝 待优化项

### 短期优化
1. **任务验证**
   - LINK类型需要验证用户是否真的访问了网站
   - 可以使用时间戳或其他机制

2. **任务冷却**
   - 添加任务冷却时间
   - 防止刷任务

3. **任务进度**
   - 显示任务完成进度
   - 添加进度条

### 中期优化
1. **更多任务**
   - 扩充任务库到50+
   - 添加更多有趣的网站

2. **任务链**
   - 实现连续任务
   - 完成A任务解锁B任务

3. **动态难度**
   - 根据玩家等级调整任务难度
   - 根据玩家等级调整奖励

### 长期优化
1. **AI生成任务**
   - 使用AI动态生成任务描述
   - 根据玩家喜好推荐任务

2. **社交功能**
   - 任务分享
   - 组队完成任务

3. **成就系统**
   - 完成特定任务组合获得成就
   - 成就奖励

## 🎯 设计哲学

> "上网站修仙也是为了上班摸鱼"

任务系统的核心是让玩家在摸鱼的同时：
1. 感到有趣（修仙包装）
2. 获得成就感（奖励机制）
3. 保持轻松（不要太肝）
4. 充满惊喜（随机任务）

## 📚 相关文档

- [事件流系统总结](./EVENT_SYSTEM_SUMMARY.md)
- [核心玩法循环](./CORE_GAMEPLAY_LOOP.md)
- [项目架构](./ARCHITECTURE_DESIGN.md)

---

**更新时间**: 2025-11-18  
**版本**: V1.0  
**状态**: ✅ 基础功能完成